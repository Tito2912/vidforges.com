# =====================================================================
# Netlify configuration for vidforges.com
# - CSP (strict) with nonce placeholder {{NONCE}}
# - Long cache for /assets and /images (1 year, immutable)
# - Short cache for HTML (10 minutes)
# - Functions directory for IndexNow endpoint
# =====================================================================

[build]
  publish = "."
  command = ""
  # Avoid automatic trailing-slash redirects; we handle canonical paths via _redirects.
  trailingSlash = "ignore"

[functions]
  directory = "netlify/functions"

# ----------------------------
# Canonical redirects handled in `_redirects`
# ----------------------------

# ----------------------------
# Global security headers
# ----------------------------
[[headers]]
  for = "/*"
  [headers.values]
    # Content Security Policy (match project spec exactly)
    Content-Security-Policy = "script-src 'self' https://www.googletagmanager.com https://www.google-analytics.com 'nonce-{{NONCE}}'; frame-src https://www.youtube-nocookie.com; img-src 'self' data: https://i.ytimg.com; media-src 'self'; connect-src 'self' https://www.google-analytics.com; style-src 'self'; base-uri 'self'; frame-ancestors 'none'; upgrade-insecure-requests;"
    Referrer-Policy = "strict-origin-when-cross-origin"
    X-Content-Type-Options = "nosniff"
    X-Frame-Options = "DENY"
    Cross-Origin-Opener-Policy = "same-origin"
    Cross-Origin-Resource-Policy = "same-origin"
    Permissions-Policy = "geolocation=(), camera=(), microphone=(), payment=()"

# ----------------------------
# Caching
# ----------------------------
# HTML: short cache (10 minutes)
[[headers]]
  for = "/*"
  [headers.values]
    Cache-Control = "public, max-age=600"

# Static assets: long cache (1 year) and immutable
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/images/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Video assets: long cache (1 year) and immutable
[[headers]]
  for = "/videos/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Optional: favicon/manifest may also be cached long-term
[[headers]]
  for = "/images/*.png"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/images/*.svg"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/images/*.ico"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/images/site.webmanifest"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# IndexNow key file â€” allow public caching (safe, static)
[[headers]]
  for = "/30013c1aaf39462fb4dae8e0518d9842.txt"
  [headers.values]
    Cache-Control = "public, max-age=86400"

# ----------------------------
# MIME niceties (optional, safe defaults)
# ----------------------------
[[headers]]
  for = "/sitemaps/*"
  [headers.values]
    Content-Type = "application/xml; charset=UTF-8"

[[headers]]
  for = "/sitemap.xml"
  [headers.values]
    Content-Type = "application/xml; charset=UTF-8"

[[headers]]
  for = "/robots.txt"
  [headers.values]
    Content-Type = "text/plain; charset=UTF-8"
